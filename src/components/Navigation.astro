---
// src/components/Navigation.astro
// Dynamic navigation that reads from site-config.json

import siteConfig from '../data/site-config.json';
import menuConfig from '../data/navigation-menu.json';

const currentPath = Astro.url.pathname;

// Helper to check if link is active
const isActive = (path: string) => currentPath.startsWith(path);

// Icon SVG path for Canadian maple leaf
const mapleLeafIcon = 'M12 2l1.5 4.5L18 6l-3 3 .5 4.5L12 12l-3.5 1.5L9 9l-3-3 4.5-.5z M12 2v10';
---

<header class="bg-slate-800 shadow-md sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-4">
    <div class="flex justify-between items-center">
      <!-- Styled Logo - CANADIAN MAPLE LEAF ICON -->
      <a href="/" class="flex items-center gap-4 group">
        <!-- Logo Icon/Badge - PROPER MAPLE LEAF -->
        <div class="relative flex-shrink-0">
          <div class="h-16 w-16 rounded-2xl bg-gradient-to-br from-red-500 via-red-600 to-red-700 flex items-center justify-center shadow-xl group-hover:shadow-2xl group-hover:scale-105 transition-all duration-300">
            <svg class="h-10 w-10 text-white" fill="currentColor" viewBox="0 0 24 24">
              <!-- Proper Canadian Maple Leaf -->
              <path d="M12 1l1.5 3.5L16 3l-1 3.5 3.5.5-3 2 1.5 3.5-3-1.5L12 15l-2-4.5-3 1.5 1.5-3.5-3-2 3.5-.5L8 3l2.5 1.5L12 1z"/>
            </svg>
          </div>
          <!-- Animated ring on hover -->
          <div class="absolute inset-0 rounded-2xl bg-gradient-to-br from-red-400 to-red-600 opacity-0 group-hover:opacity-50 group-hover:scale-115 transition-all duration-300 blur-lg"></div>
        </div>
        
        <!-- Logo Text - READS FROM CONFIG -->
        <div class="flex flex-col gap-0.5">
          <!-- Line 1: Full Name from config -->
          <span class="text-xl font-bold text-white group-hover:text-cyan-100 transition-all duration-300 leading-tight">
            {siteConfig.company.name}
          </span>
          
          <!-- Line 2: Tagline from config -->
          <span class="text-xs text-cyan-300 opacity-90 font-semibold italic leading-tight">
            {siteConfig.company.tagline}
          </span>
        </div>
      </a>
      
      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-6">
        {menuConfig.mainMenu.map((item) => {
          if (item.type === 'link') {
            return (
              <a 
                href={item.url}
                class={`text-white hover:text-blue-300 transition-colors ${item.highlighted ? 'font-medium' : ''} ${isActive(item.url) ? 'text-blue-300' : ''}`}
              >
                {item.label}
              </a>
            );
          } else if (item.type === 'dropdown') {
            return (
              <div class="relative group">
                <button 
                  class={`text-white hover:text-blue-300 transition-colors flex items-center gap-1 ${isActive('/resources') ? 'text-blue-300' : ''}`}
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  {item.label}
                  <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                  </svg>
                </button>
                
                <!-- Dropdown Menu -->
                <div class="absolute top-full left-0 mt-2 w-64 bg-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                  <div class="py-2">
                    {item.items.map((subItem, index) => (
                      <a 
                        href={subItem.url}
                        class={`block px-4 py-3 hover:bg-blue-50 transition-colors ${index < item.items.length - 1 ? 'border-b border-gray-100' : ''}`}
                      >
                        <div class="flex items-center gap-3">
                          <span class="text-2xl">{subItem.icon}</span>
                          <div>
                            <div class="font-semibold text-gray-900">{subItem.label}</div>
                            <div class="text-xs text-gray-600">{subItem.description}</div>
                          </div>
                        </div>
                      </a>
                    ))}
                  </div>
                </div>
              </div>
            );
          }
        })}
      </nav>

      <!-- Mobile Menu Button -->
      <button 
        id="mobile-menu-button"
        class="lg:hidden text-white p-2 hover:bg-slate-700 rounded-lg transition-colors"
        aria-label="Toggle menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden lg:hidden mt-4 pb-4">
      <div class="flex flex-col space-y-3">
        {menuConfig.mainMenu.map((item) => {
          if (item.type === 'link') {
            return (
              <a 
                href={item.url}
                class={`text-white hover:text-blue-300 transition-colors py-2 ${item.highlighted ? 'font-medium' : ''} ${isActive(item.url) ? 'text-blue-300' : ''}`}
              >
                {item.label}
              </a>
            );
          } else if (item.type === 'dropdown') {
            return (
              <div>
                <button 
                  class={`mobile-dropdown-toggle text-white hover:text-blue-300 transition-colors py-2 w-full text-left flex items-center justify-between ${isActive('/resources') ? 'text-blue-300' : ''}`}
                  data-target={`mobile-${item.id}-menu`}
                >
                  {item.label}
                  <svg class="w-4 h-4 transition-transform mobile-dropdown-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                  </svg>
                </button>
                
                <div id={`mobile-${item.id}-menu`} class="hidden pl-4 mt-2 space-y-2">
                  {item.items.map((subItem) => (
                    <a href={subItem.url} class="block text-gray-300 hover:text-blue-300 py-1 text-sm">
                      {subItem.icon} {subItem.label}
                    </a>
                  ))}
                </div>
              </div>
            );
          }
        })}
      </div>
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle
  document.addEventListener('DOMContentLoaded', () => {
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    
    menuButton?.addEventListener('click', () => {
      mobileMenu?.classList.toggle('hidden');
    });
    
    // Mobile dropdown toggles
    const dropdownToggles = document.querySelectorAll('.mobile-dropdown-toggle');
    dropdownToggles.forEach(toggle => {
      toggle.addEventListener('click', () => {
        const targetId = toggle.getAttribute('data-target');
        const targetMenu = document.getElementById(targetId);
        const icon = toggle.querySelector('.mobile-dropdown-icon');
        
        targetMenu?.classList.toggle('hidden');
        icon?.classList.toggle('rotate-180');
      });
    });
  });
</script>

<style>
  /* Ensure dropdown stays visible on hover */
  .group:hover .group-hover\:opacity-100 {
    pointer-events: auto;
  }
</style>
